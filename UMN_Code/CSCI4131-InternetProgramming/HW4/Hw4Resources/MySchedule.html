<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>My Weekly Schedule</title>
		<style>
			body { background-color: rgb(200,225,255); color: rgb(0,50,100); }
			#time { color: rgb(0,35,70); }
			table {
				padding: 0px;
				margin: 0px;
			}
			th table, th table tr, th table tr th {
				border: 1px solid rgb(0,50,100);
				border-collapse: collapse;
				padding-left: 4px;
				padding-right: 4px;
				font-weight: normal;
			}
			img { width:50px; }
			.bigImage { width:300px; }
			nav a {
				border: 1px solid rgb(0,50,100);
				width: auto;
				padding: 2px 10px 2px 10px;
				font-weight: bold;
				background-color: rgb(100,175,125);
			}
			p {
				margin-top: 0px;
				margin-bottom: 5px;
			}
			#fadeToggle { width: 100px; }
			#directions {
				height: 500px;
				background: rgb(240,250,255);
				color: rgb(20,0,100);
				border: 1px solid black;
				vertical-align: top;
				text-align: left;
				padding-left: 15px;
				padding-right: 15px;
				padding-top: 10px;
			}
			#map {
				height: 500px;
				width: 67vw;
			}
			#mapInput {
				background: rgb(240,250,255);
				height: 500px;
				width: 33vw;
				color: rgb(20,0,100);
				border: 1px solid black;
			}
			#placeOther { width: 49%; }
			#placeRadius {
				width: 24%;
				text-align: center;
			}
			#destination { width: 80%; }
			#radios {
				text-align: left;
				margin-left: 35%;
			}
			#Driving, #Walking, #Transit { width: 5%; }
			#directionsPanel {
				height: 90%;
				overflow: auto;
			}
			/* colors for use in table-background color-coding */
			.gray {background: lightgray; font-weight: bold;} /* Header column/row */
			.yellow {background: rgb(255,255,220);} /* CSCI4131 */
			.blue {background: rgb(220,240,255);} /* CSCI3003 */
			.green {background: rgb(220,255,220);} /* CSCI5801 */
			.red {background: rgb(255,220,220);} /* CSCI4271W */
			.purple {background: rgb(255,220,255);} /* Extracurriculars */
			.lightgray {background: rgb(230,230,230);} /* Personal Time */


			iframe { border: 0; }
			p {
				font-size: 24pt;
				font-weight: bold;
			}
			.pwOuter {
				border: 3px dotted rgb(200,150,200);
				background-color: rgb(225,200,255);
				font-weight: normal;
			}
			.PWChecker {
				border: 1px solid rgb(0,50,100);
				border-collapse: collapse;
				color: rgb(200,225,255);
				width: 60%;
				height: 20px;
				margin-left: 20%;
			}
			#PWStrength, caption {
				font-size: 12pt;
				font-weight: normal;
				color: rgb(0,50,100);
			}


			.formTable {
				text-align: right;
				width:auto;
				height: auto;
			}

			input { width: 96% }

			#submit, #Clear {
				text-align: center;
				width: 100%
			}

			#day { width: 100%; }

			#start, #end { width: 97%; }

			#info {
				width: 200px;
				height: 100px;
			}
			#formMap {
				width: 54vw;
				height: 350px;
			}
		</style>
	</head>
	
	<body>
		<script defer
			src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBoqNxtO1ERzFfzuVLFWilsMr44zew_zJ0&libraries=places&callback=initMap">
		</script>
		
		<nav>
			<a href="MySchedule.html">Weekly Schedule</a>
			<a href="MyWidgets.html">My Widgets</a>
			<a href="MyForm.html">My Form</a>
		</nav>
		
		<br><div id="time">Current Time:</div>
		
		<h1> My Weekly Schedule </h1>
		
		<table>
			<tr>
				<th colspan="2">
					<table> <!-- 'â€‘' is a non-breaking hyphen (the word won't be split into two if it reaches end of the line) -->
						<tr class="gray"> <!-- Header -->
							<th><strong>Day</strong></th>
							<th><strong>Event</strong></th>
							<th><strong>Time</strong></th>
							<th><strong>Event Location</strong></th>
							<th><strong>Phone Number</strong></th>
							<th><strong>URL</strong></th>
						</tr>
						<tr class="lightgray"> <!-- Sunday -->
							<th class="gray">Sunday</th>
							<th>Study Time</th>
							<th>1pm - 6pm</th>
							<th>Wherever</th>
							<th>None</th>
							<th><a href="https://www.youtube.com/watch?v=3jWRrafhO7M" target="_blank">My Go-To Study Music</a></th>
						</tr>
						<tr class="yellow"> <!-- Monday -->
							<th class="gray">Monday</th>
							<th>CSCI4131 Lecture</th>
							<th>9:45am - 11:00am</th>
							<th>5 Blegen Hall</th>
							<th>None</th>
							<th><a href="https://umn.instructure.com/courses/268388" target="_blank">CSCI4131 Info</a></th>
						</tr>
						<tr class="green"> <!-- Tuesday -->
							<th rowspan="3" class="gray">Tuesday</th>
							<th>CSCI5801 Lecture</th>
							<th>9:45am - 11:00am</th>
							<th>3-210 Keller Hall</th>
							<th>None</th>
							<th><a href="https://umn.instructure.com/courses/268021" target="_blank">CSCI5801 Info</a></th>
						</tr>
						<tr class="blue">
							<th>CSCI3003 Lecture</th>
							<th>2:30pm - 3:45pm</th>
							<th>3-230 Keller Hall</th>
							<th>None</th>
							<th><a href="https://umn.instructure.com/courses/268657" target="_blank">CSCI3003 Info</a></th>
						</tr>
						<tr class="red">
							<th>CSCI4271W Lecture</th>
							<th>4:00pm - 5:15pm</th>
							<th>3-125 Keller Hall</th>
							<th>None</th>
							<th><a href="https://umn.instructure.com/courses/268725" target="_blank">CSCI4271W Info</a></th>
						</tr>
						<tr class="yellow"> <!-- Wednesday -->
							<th rowspan="2" class="gray">Wednesday</th>
							<th>CSCI4131 Lecture</th>
							<th>9:45am - 11:00am</th>
							<th>5 Blegen Hall</th>
							<th>None</th>
							<th><a href="https://umn.instructure.com/courses/268388" target="_blank">CSCI4131 Info</a></th>
						</tr>
						<tr class="red">
							<th>CSCI4271W Lab</th>
							<th>4:40pm - 5:30pm</th>
							<th>1-250 Keller Hall</th>
							<th>None</th>
							<th><a href="https://umn.instructure.com/courses/268725" target="_blank">CSCI4271W Info</a></th>
						</tr>
						<tr class="green"> <!-- Thursday -->
							<th rowspan="3" class="gray">Thursday</th>
							<th>CSCI5801 Lecture</th>
							<th>8:45am - 11:00am</th>
							<th>3-210 Keller Hall</th>
							<th>None</th>
							<th><a href="https://umn.instructure.com/courses/268021" target="_blank">CSCI5801 Info</a></th>
						</tr>
						<tr class="blue">
							<th>CSCI3003 Lecture</th>
							<th>2:30pm - 3:45pm</th>
							<th>3-230 Keller Hall</th>
							<th>None</th>
							<th><a href="https://umn.instructure.com/courses/268657" target="_blank">CSCI3003 Info</a></th>
						</tr>
						<tr class="red">
							<th>CSCI4271W Lecture</th>
							<th>4:00pm - 5:15pm</th>
							<th>3-125 Keller Hall</th>
							<th>None</th>
							<th><a href="https://umn.instructure.com/courses/268725" target="_blank">CSCI4271W Info</a></th>
						</tr>
						<tr class="blue"> <!-- Friday -->
							<th rowspan="3" class="gray">Friday</th>
							<th>CSCI3003 Lab</th>
							<th>12:20pm - 2:15pm</th>
							<th>1-260 Keller Hall</th>
							<th>None</th>
							<th><a href="https://umn.instructure.com/courses/268657" target="_blank">CSCI3003 Info</a></th>
						</tr>
						<tr class="purple">
							<th>Tesla Works Club</th>
							<th>4:30pm-6:30pm</th>
							<th>2-160 Keller Hall</th>
							<th>None</th>
							<th><a href="https://teslaworks.net/" target="_blank">Tesla Works Website</a></th>
						</tr>
						<tr class="purple">
							<th>Dungeons and Dragons Club</th>
							<th>6:30pm</th>
							<th>114 Bruininks Hall</th>
							<th>None</th>
							<th><a href="https://twin-cities-umn.presence.io/organization/dungeons-and-dragons-club-3353" target="_blank">D&D Club Website</a></th>
						</tr>
						<tr class="lightgray"> <!-- Saturday -->
							<th class="gray">Saturday</th>
							<th>Weekend Chores</th>
							<th>1pm - 3pm</th>
							<th>220 Delaware St SE, Minneapolis, MN 55455</th>
							<th>None</th>
							<th>None</th>
						</tr>
					</table>
				</th>
				<th colspan="1">
					<button type="button" id="fadeToggle" name="fadeToggle">Go Away!</button><br>
					<img src="img/gophers-mascot.png" alt="Gopher Mascot Image" class="bigImage">
				</th>
			</tr>
			<tr>
				<th id="directions" colspan="1">
					<p>Directions:</p><br>
					Directions will show up here!
				</th>
				<th colspan="1">
					<div id="map"></div>
				</th>
				<th id="mapInput" colspan="1">
					<p>Search for a Place</p>
					<label for="placeCategory">Type of Place:</label>
					<select id="placeCategory" name="placeCategory">
						<option value="" disabled selected>Type of Place</option>
						<option value="Restaurant">Restaurant</option>
						<option value="Hospital">Hospital</option>
						<option value="Parking">Parking</option>
						<option value="Supermarket">Supermarket</option>
						<option value="Other">Other</option>
					</select><br>
					<label for="placeOther">Other:</label>
					<input id="placeOther" name="placeOther" type="text" disabled><br>
					<label for="placeRadius">Radius (in miles):</label>
					<input id="placeRadius" name="placeRadius" type="number" value="5" min="0" max="31">
					<p><button type="button" id="placeSearch" name="placeSearch">Search</button></p><br><br>
					<p>Get Directions</p>
					<label for="destination">Destination:</label>
					<input id="destination" name="destination" type="text">
					<br>Method of Transportation:<br>
					<div id="radios">
						<input type="radio" name="trMethod" id="Driving" value="Driving" checked>
						<label for="Driving">Driving</label><br>
						<input type="radio" name="trMethod" id="Walking" value="Walking">
						<label for="Walking">Walking</label><br>
						<input type="radio" name="trMethod" id="Transit" value="Transit">
						<label for="Transit">Transit</label><br>
					</div>
					<p><button type="button" id="getDirections" name="getDirections">Go!</button></p>
				</th>
			</tr>
		</table>
		<script>
			/*
			 * Script for MySchedule.html.
			**/

			//variables (particularly for the schedule and big image)
			var bigImg = document.getElementsByClassName("bigImage")[0];
			var weekEvents = document.querySelectorAll("th table tr th");
			var tempMem = "";

			var weekEventsIdxs = [7,13,19,24,29,35,40,46,51,56,62,67,72,78];
			var weekEventsSrcs = ["lab.jpg","html5.png","UML.png","dna.jpg",
								  "CyberSec.jpg","html5.png","CyberSec.jpg",
								  "UML.png","dna.jpg","CyberSec.jpg","dna.jpg",
								  "teslaworks.png","DnD.jpg","chores.png"];
			var weekEventsAlts = ["Study Time","CSCI4131 Lecture",
								 "CSCI5801 Lecture","CSCI3003 Lecture",
								 "CSCI4271W Lecture","CSCI4131 Lecture",
								 "CSCI4271W Lab","CSCI5801 Lecture",
								 "CSCI3003 Lecture","CSCI4271W Lecture",
								 "CSCI3003 Lab","Tesla Works Club",
								 "Dungeons and Dragons Club","Weekend Chores"];

			//set up eventListeners for mouseenter and mouseleave
			for (let i = 0; i < weekEventsIdxs.length; i++) {
				for (let j = 0; j < 5; j++) {
					//swap big image to correct one, put correct image in the cell
					weekEvents[weekEventsIdxs[i]+j].addEventListener("mouseenter", function(event) {
						tempMem = weekEvents[weekEventsIdxs[i]+j].innerHTML;
						bigImg.src = "img/" + weekEventsSrcs[i];
						bigImg.alt = weekEventsAlts[i];
						if (!tempMem.includes("<br><img")) {
							weekEvents[weekEventsIdxs[i]+j].innerHTML =
								"<th>" + tempMem + "</th>" + '<br><img src="img/' +
								weekEventsSrcs[i] + '" alt=' + weekEventsAlts[i] + "></th>";
						}
					});
					//remove image from the cell mouse just left
					weekEvents[weekEventsIdxs[i]+j].addEventListener("mouseleave", function(event) {
						if (weekEvents[weekEventsIdxs[i]+j].innerHTML.includes("<br><img")) {
							lastChar = tempMem.slice(-1);
							if (lastChar == ">") {lastChar = "";}
							weekEvents[weekEventsIdxs[i]+j].innerHTML =
								tempMem.slice(0,tempMem.indexOf("<br><img")) + lastChar + "</th>";
						}
					});
				}
			}

			//animation for big image (Go Away! and Come Back!)
			var fadeButton = document.getElementById('fadeToggle');
			var faded = false;
			fadeButton.addEventListener("click",function(event) {
				if (faded) {
					bigImg.animate([{opacity:0},{opacity:1}],2000);
					bigImg.style.opacity = 1;
					fadeButton.innerHTML = "Go Away!";
					faded = false;
				} else {
					bigImg.animate([{opacity:1},{opacity:0}],2000);
					bigImg.style.opacity = 0;
					fadeButton.innerHTML = "Come Back!";
					faded = true;
				}
			});

			//map script
			var map = null;
			var directionsService = null;
			var directionsRenderer = null;
			function initMap() {
				map = new google.maps.Map(document.getElementById("map"),
					{
						zoom: 14,
						center: { lat: 44.9727, lng: -93.23540000000003 },
						mapId: "b045800e9be6e168"
					}
				);
				directionsService = new google.maps.DirectionsService(map);
				directionsRenderer = new google.maps.DirectionsRenderer();
			}

			//dynamically extract table elements
			var events = [];
			var singleEvent = [];
			var day = "";
			const daysOfTheWeek = ["Day","Sunday", "Monday", "Tuesday",
				"Wednesday", "Thursday", "Friday", "Saturday"];
			for (let i = 0; i < weekEvents.length; i++) {
				if (singleEvent.length >= 6) {
					events.push(singleEvent);
					singleEvent = [];
				}
				if (daysOfTheWeek.includes(weekEvents[i].textContent)) {
					day = weekEvents[i].textContent;
				}
				if (singleEvent.length == 0) {
					singleEvent.push(day);
				}
				if (singleEvent.length < 6 && singleEvent.length >= 1 && !singleEvent[0].includes(weekEvents[i].textContent)) {
					singleEvent.push(weekEvents[i].textContent);
				}
			}
			if (singleEvent.length >= 6) events.push(singleEvent);

			//place markers
			var markedPlaces = [];
			const ignoredPlaces = ["Event Location","Wherever","None"];
			var currMarker = 0;
			var eventMarkers = [];
			window.addEventListener("load", function(event) {
				var service = new google.maps.places.PlacesService(map);
				function placeMarker(results, Status) {
					if (results != null) {
						//marker
						let place = markedPlaces[currMarker];
						currMarker++;
						let markerText = "";
						for (let i = 0; i < events.length; i++) {
							if (events[i][3].includes(place) && !markerText.includes(events[i][3])) {
								markerText += events[i][1] + ": " + events[i][3] + "\n";
							}
						}
						
						let latlng = { lat: results[0].geometry.location.lat(),
									   lng: results[0].geometry.location.lng()
									 };
						let markerDets = {
							position: latlng,
							map: map,
							title: markerText,
							icon: "img/marker.jpg"
						};
						const marker = new google.maps.Marker(markerDets);
						
						//info window
						let infoText = "";
						for (let i = 0; i < events.length; i++) {
							if (events[i][3].includes(place)) {
								infoText += "<b>" + events[i][0] + " at " + events[i][2] + ":</b><br>";
								infoText += events[i][1] + " at " + events[i][3] + "<br>";
							}
						}
						const infowindow = new google.maps.InfoWindow({ content: infoText});
						
						marker.addListener("click", function(event) {
							infowindow.open({
								anchor: marker,
								map,
								shouldFocus: false
							});
						});
						eventMarkers.push(marker);
					} else if (Status != "OK") {
						console.log("Error! " + Status);
					}
				}
				//send request to PlacesService API
				for (let i = 0; i < events.length; i++) {
					let place = events[i][3];
					if (place.includes("Keller Hall")) { place = "Keller Hall"; }
					if (place.includes("Blegen Hall")) { place = "Blegen Hall"; }
					if (place.includes("Bruininks Hall")) { place = "Bruininks Hall"; }
					if (!ignoredPlaces.includes(place) && !markedPlaces.includes(place)) {
						markedPlaces.push(place);
						let queryRequest = {query:place,fields:["geometry.location"]};
						service.findPlaceFromQuery(queryRequest,placeMarker);
					}
				}
			});

			//input area
			var category = document.getElementById("placeCategory");
			var other = document.getElementById("placeOther");
			var radius = document.getElementById("placeRadius");
			var search = document.getElementById("placeSearch");
			category.addEventListener("change",function(event) {
				if (category.value == "Other") {
					other.disabled = false;
				} else {
					other.disabled = true;
					other.value = "";
				}
			});
			//search for locations
			var otherMarkers = [];
			search.addEventListener("click",function(event) {
				for (let i = 0; i < eventMarkers.length; i++) eventMarkers[i].setMap(null);
				for (let i = 0; i < otherMarkers.length; i++) otherMarkers[i].setMap(null);
				otherMarkers.length = 0;
				var service = new google.maps.places.PlacesService(map);
				function addMarker(results, Status) {
					if (results != null) {
						//place results' markers
						for (let i = 0; i < results.length; i++) {
							let markerInfo = {
								content: "<b>" + results[i].name + ":</b> " + results[i].vicinity
							};
							let markerDets = {
								position: results[i].geometry.location,
								map: map,
								title: markerInfo.content
							}
							const marker = new google.maps.Marker(markerDets);
							const infowindow = new google.maps.InfoWindow(markerInfo);
							marker.addListener("click", function(event) {
								infowindow.open({
									anchor: marker,
									map,
									shouldFocus: false
								});
							});
							otherMarkers.push(marker);
						}
					} else if (Status != "OK") {
						console.log("Error! " + Status)
					}
				}
				let queryText = category.value;
				let searchType = false;
				if (queryText == "Other") {
					queryText = other.value;
					searchType = true;
				}
				if (queryText != "") {
					query = {
						location: new google.maps.LatLng(44.9727, -93.23540000000003),
						radius: radius.value * 1609.34
					};
					if (searchType) {
						query.type = queryText;
					} else {
						query.keyword = queryText;
					}
					service.nearbySearch(query, addMarker);
				} else {
					for (let i = 0; i < eventMarkers.length; i++) eventMarkers[i].setMap(map);
					console.log("Invalid search query");
				}
			});

			//directions
			var destination = document.getElementById("destination");
			var method = document.getElementsByName("trMethod");
			var goButton = document.getElementById("getDirections");
			var directionsText = document.getElementById("directions");
			goButton.addEventListener("click", function(event) {
				destinationValue = destination.value;
				if (destinationValue != "") {
					if (navigator.geolocation) {
						function usePosition(position) {
							coordinates = {
								lat: position.coords.latitude,
								lng: position.coords.longitude
							};
							methodValue = "DRIVING";
							for (let i = 0; i < method.length; i++) {
								if (method[i].checked) methodValue = method[i].value.toUpperCase();
							}
							query = {
								origin: coordinates,
								destination: destinationValue,
								travelMode: methodValue
							};
							
							directionsRenderer.setMap(map);
							directionsService.route(query,function(result, status) {
								if (status == "OK") {
									directionsRenderer.setDirections(result);
									directionsText.innerHTML = "<p>Directions:</p><div id='directionsPanel'></div>";
									directionsRenderer.setPanel(document.getElementById("directionsPanel"));
								}
							});
						}
						navigator.geolocation.getCurrentPosition(usePosition);
						
					} else {
						directionsText.innerHTML = "<p>Directions:</p><br>Browser does not support Geolocation.";
					}
				} else {
					directionsText.innerHTML = "<p>Directions:</p><br>Enter in a destination!";
				}
			});

			//clock
			function clock() {
				var datetoday = new Date();
				var timenow = datetoday.toLocaleTimeString();
				document.getElementById("time").innerHTML = "Current Time: " + timenow;
				dayOfWeek = datetoday.getDay();
				let found = false;
				let day = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
				nextDay = day[(datetoday.getDay() + 1) % 7];
				day = day[datetoday.getDay()];
				for (let i = 0; i < weekEvents.length; i++) {
					if (weekEvents[i].textContent == day) { found = true; }
					if (weekEvents[i].textContent == nextDay) { found = false; }
					if (found) { weekEvents[i].style.color = "rgb(0,150,0)"; }
					else { weekEvents[i].style.color = "rgb(0,50,100)"; }
					}
			}

			var intId = setInterval(function(){clock()},1000);
		</script>
	</body>
</html>